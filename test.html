<!DOCTYPE html>
<html lang="zh-cmn-hans">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
        <title>WeixinJSBridge Test</title>
    </head>
    <body>
        <script> 

function is_weixin() {
    if (/MicroMessenger/i.test(navigator.userAgent)) {
        return true
    } else {
        return false
    }
}
function is_android() {
    var a = navigator.userAgent.toLowerCase();
    if (a.match(/(Android|SymbianOS)/i)) {
        return true
    } else {
        return false
    }
}
function is_ios() {
    var a = navigator.userAgent.toLowerCase();
    if (/iphone|ipad|ipod/.test(a)) {
        return true
    } else {
        return false
    }
}

function weixinShareTimeline(title,desc,link,imgUrl){  
    window.WeixinJSBridge.invoke('shareTimeline',{  
        "img_url":imgUrl,  
        //"img_width":"640",  
        //"img_height":"640",  
        "link":link,  
        "desc": desc,  
        "title":title  
    });   
}

function listenShare() {
 window.WeixinJSBridge.on('menu:share:timeline', function(argv){
 
      window.WeixinJSBridge.invoke('shareTimeline',{
 
    "appid":"",                                              //appid 设置空就好了。
    "img_url":  'http://7vzp6r.com1.z0.glb.clouddn.com/avatar.png',                                   //分享时所带的图片路径
    "img_width": "120",                            //图片宽度
    "img_height": "120",                            //图片高度
    "link":'http://yubolun.com',                                               //分享附带链接地址
    "desc":"我是一个介绍",                            //分享内容介绍
    "title":"标题，再简单不过了。"
   }, function(res){/*** 回调函数，最好设置为空 ***/});   
 })
}

function hideOptions() {
    window.WeixinJSBridge.invoke('hideOptionMenu',{},function(res){
        alert(res.err_msg);
    })
}
       

function onAutoinit() {
    window.WeixinJSBridge = WeixinJSBridge;
    window.weixinShareTimeline('js bridge test','this is a test','http://yubolun.com','http://7vzp6r.com1.z0.glb.clouddn.com/avatar.png');
    listenShare();
    hideOptions();
    
}
if (is_weixin()) {
    if (typeof WeixinJSBridge == "undefined") {
        if (document.addEventListener) {
            document.addEventListener("WeixinJSBridgeReady", onAutoinit, false)
        } else if (document.attachEvent) {
            document.attachEvent("WeixinJSBridgeReady", onAutoinit);
            document.attachEvent("onWeixinJSBridgeReady", onAutoinit)
        }
    } else {
        onAutoinit()
    }
}
</script>
    </body>
</html>
